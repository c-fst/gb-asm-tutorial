<!DOCTYPE HTML>
<html lang="it" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Oggetti - GB ASM Tutorial</title>

        <!-- Custom HTML head -->
        <meta name="twitter:card" content="summary_large_image"/>
        <meta name="twitter:site:id" content="@gbdev0"/>
        <meta property="og:title" content="Oggetti - GB ASM Tutorial" />
        <meta property="og:image" content="https://gbdev.io/gb-asm-tutorial/assets/banner/1200x628.png" />
        <meta property="og:site_name" content="GB ASM Tutorial"/>

        <meta name="description" content="A complete guide to programming Game Boy games in assembly.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../css/custom.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../index.html">Home</a></li><li class="chapter-item affix "><a href="../roadmap.html">Tabella di marcia</a></li><li class="chapter-item affix "><a href="../help-feedback.html">Aiuto e Suggerimenti</a></li><li class="chapter-item affix "><li class="part-title">Parte ‚Ö† - Hello World!</li><li class="chapter-item "><a href="../part1/setup.html"><strong aria-hidden="true">1.</strong> Configurazione</a></li><li class="chapter-item "><a href="../part1/hello_world.html"><strong aria-hidden="true">2.</strong> Hello World!</a></li><li class="chapter-item "><a href="../part1/toolchain.html"><strong aria-hidden="true">3.</strong> Strumenti di lavoro</a></li><li class="chapter-item "><a href="../part1/bin_and_hex.html"><strong aria-hidden="true">4.</strong> Binario ed esadecimale</a></li><li class="chapter-item "><a href="../part1/registers.html"><strong aria-hidden="true">5.</strong> Registri</a></li><li class="chapter-item "><a href="../part1/assembly.html"><strong aria-hidden="true">6.</strong> Basi di Assembly</a></li><li class="chapter-item "><a href="../part1/memory.html"><strong aria-hidden="true">7.</strong> Memoria</a></li><li class="chapter-item "><a href="../part1/header.html"><strong aria-hidden="true">8.</strong> The header</a></li><li class="chapter-item "><a href="../part1/operations.html"><strong aria-hidden="true">9.</strong> Operazioni e flags</a></li><li class="chapter-item "><a href="../part1/jumps.html"><strong aria-hidden="true">10.</strong> Jumps</a></li><li class="chapter-item "><a href="../part1/tracing.html"><strong aria-hidden="true">11.</strong> Tracing</a></li><li class="chapter-item "><div><strong aria-hidden="true">12.</strong> Grafica</div><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../part1/tiles.html"><strong aria-hidden="true">12.1.</strong> Tiles</a></li><li class="chapter-item "><a href="../part1/palettes.html"><strong aria-hidden="true">12.2.</strong> Palette</a></li><li class="chapter-item "><a href="../part1/tilemap.html"><strong aria-hidden="true">12.3.</strong> Tilemap</a></li></ol></li><li class="chapter-item "><a href="../part1/wrapup.html"><strong aria-hidden="true">13.</strong> In conclusione</a></li><li class="chapter-item affix "><li class="part-title">Parte ‚Ö° - Il nostro primo gioco</li><li class="chapter-item "><a href="../part2/getting-started.html"><strong aria-hidden="true">14.</strong> Per iniziare</a></li><li class="chapter-item expanded "><a href="../part2/objects.html" class="active"><strong aria-hidden="true">15.</strong> Oggetti</a></li><li class="chapter-item "><a href="../part2/functions.html"><strong aria-hidden="true">16.</strong> Funzioni</a></li><li class="chapter-item "><a href="../part2/input.html"><strong aria-hidden="true">17.</strong> Input</a></li><li class="chapter-item "><a href="../part2/collision.html"><strong aria-hidden="true">18.</strong> Collisioni</a></li><li class="chapter-item "><a href="../part2/wip.html"><strong aria-hidden="true">19.</strong> Lavori in corso</a></li><li class="chapter-item affix "><li class="part-title">Parte ‚Ö¢ - Il nostro secondo gioco</li><li class="chapter-item "><div><strong aria-hidden="true">20.</strong> Da scrivere...</div></li><li class="spacer"></li><li class="chapter-item affix "><a href="../next.html">Prossimi passi</a></li><li class="chapter-item affix "><a href="../resources.html">Risorse</a></li><li class="chapter-item affix "><a href="../thanks.html">Ringraziamenti</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">GB ASM Tutorial</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        <button id="language-toggle" class="icon-button" type="button"
                                title="Change language" aria-label="Change language"
                                aria-haspopup="true" aria-expanded="false"
                                aria-controls="language-list">
                            <i class="fa fa-globe"></i>
                        </button>
                        <ul id="language-list" class="theme-popup" aria-label="Languages" role="menu">
                          <li role="none"><button role="menuitem" class="theme">
                              <a id="en">English</a>
                          </button></li>
                          <li role="none"><button role="menuitem" class="theme">
                              <a id="it">Italian</a>
                          </button></li>
                        </ul>

                        <script>
                          let langToggle = document.getElementById("language-toggle");
                          let langList = document.getElementById("language-list");
                          langToggle.addEventListener("click", (event) => {
                              langList.style.display = langList.style.display == "block" ? "none" : "block";
                          });
                          let selectedLang = document.getElementById("it");
                          selectedLang.parentNode.classList.add("theme-selected");

                          // The path to the root, taking the current
                          // language into account.
                          let full_path_to_root = "../../";
                          // The page path (mdbook only gives us
                          // access to the path to the Markdown file).
                          let path = "part2/objects.md".replace(/\.md$/, ".html");
                          for (let lang of langList.querySelectorAll("a")) {
                              if (lang.id == "en") {
                                  lang.href = `${full_path_to_root}${path}`;
                              } else {
                                  lang.href = `${full_path_to_root}${lang.id}/${path}`;
                              }
                          }
                        </script>

                        
                        <a href="https://github.com/gbdev/gb-asm-tutorial" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/gbdev/gb-asm-tutorial/edit/main/po/it.po"
                           title="Suggest an edit to the translation" aria-label="Suggest an edit to the translation">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="oggetti"><a class="header" href="#oggetti">Oggetti</a></h1>
<p>Lo sfondo √® molto utile quando l‚Äôintero schermo deve muoversi contemporaneamente, ma non √® l‚Äôideale per tutto.
Ad esempio, il cursore in un menu, i PNG e il giocatore in un RPG, i proiettili in uno shmup o le palline in un clone di <em>Arkanoid</em>‚Ä¶ devono tutti muoversi indipendentemente dallo sfondo.
Fortunatamente, il Game Boy ha una funzione perfetta per queste situazioni!
In questa lezione parleremo di <em>oggetti</em> (talvolta chiamati ‚ÄúOBJ‚Äù).</p>
<div class="box tip">
<p>La descrizione precedente potrebbe avervi fatto pensare al termine ‚Äúsprite‚Äù invece che a ‚Äúoggetto‚Äù.
Il termine ‚Äúsprite‚Äù ha <em>molti</em> significati a seconda del contesto, quindi, per evitare confusione, questo tutorial cerca di usare alternative specifiche, come <em>oggetto</em>, <em>metasprite</em>, <em>attore</em>, ecc.</p>
</div>
<p>Ogni oggetto permette di disegnare una o due piastrelle (rispettivamente 8√ó8 o 8√ó16 pixel) in qualsiasi posizione sullo schermo, a differenza dello sfondo, dove tutte le piastrelle sono disegnate in una griglia.
Pertanto, un oggetto √® composto dalla sua posizione sullo schermo, da un ID tile (come <a href="../part1/tilemap.html">con la tilemap</a>) e da alcune propriet√† extra chiamate ‚Äúattributi‚Äù.
Queste propriet√† extra consentono, ad esempio, di visualizzare la piastrella capovolta.
Ne parleremo pi√π avanti.</p>
<p>Proprio come la tilemap √® memorizzata nella VRAM, gli oggetti vivono in una regione di memoria chiamata OAM, ovvero <strong>Object Attribute Memory</strong>.
Ricordiamo che un oggetto √® composto da:</p>
<ul>
<li>La sua posizione sullo schermo</li>
<li>Un ID tile</li>
<li>Gli ‚Äúattributi‚Äù</li>
</ul>
<p>Questi sono memorizzati in 4 byte: uno per la coordinata Y, uno per la coordinata X, uno per l‚ÄôID della piastrella e uno per gli attributi.
L‚ÄôOAM √® lungo 160 byte e poich√© 160 ‚àï 4 = 40, il Game Boy memorizza un totale di <strong>40</strong> oggetti in qualsiasi momento.</p>
<p>C‚Äô√® per√≤ un problema: i byte delle coordinate Y e X di un oggetto in OAM non memorizzano la sua posizione sullo schermo!
Invece, la posizione X <em>sullo schermo</em> √® la posizione X <em>memorizzata</em> <strong>meno 8</strong>, e la posizione Y <em>sullo schermo</em> √® la posizione Y <em>memorizzata</em> <strong>meno 16</strong>.
Per interrompere la visualizzazione di un oggetto, √® sufficiente metterlo fuori dallo schermo, ad esempio impostando la sua posizione Y a 0.</p>
<div class="box tip">
<p>Questi offset non sono arbitrari!
Si consideri la dimensione massima di un oggetto: 8 x 16 pixel.
Questi offset consentono agli oggetti di essere tagliati dai bordi sinistro e superiore dello schermo.
Il NES, ad esempio, non dispone di tali offset, per cui si noter√† che gli oggetti scompaiono sempre dopo aver toccato il bordo sinistro o superiore dello schermo.</p>
</div>
<p>Scopriamo gli oggetti sperimentandoli!</p>
<p>Innanzitutto, all‚Äôaccensione del Game Boy, l‚ÄôOAM si riempie di valori semicasuali, che possono coprire lo schermo di spazzatura casuale.
Risolviamo questo problema cancellando l‚ÄôOAM prima di attivare gli oggetti per la prima volta.
Aggiungiamo quanto segue subito dopo il ciclo <code>CopyTilemap</code>:</p>
<pre><code class="language-rgbasm">	ld a, 0
	ld b, 160
	ld hl, _OAMRAM
ClearOam:
	ld [hli], a
	dec b
	jp nz, ClearOam
</code></pre>
<p>Questo √® un buon momento per farlo, poich√© proprio come la VRAM, lo schermo deve essere spento per accedere in modo sicuro alla OAM.</p>
<p>Una volta che l‚ÄôOAM √® chiaro, possiamo disegnare un oggetto scrivendo le sue propriet√†.</p>
<pre><code class="language-rgbasm linenos start=67">	ld hl, _OAMRAM
	ld a, 128 + 16
	ld [hli], a
	ld a, 16 + 8
	ld [hli], a
	ld a, 0
	ld [hli], a
	ld [hl], a
</code></pre>
<p>Si ricordi che ogni oggetto in OAM √® composto da 4 byte, nell‚Äôordine Y, X, Tile ID, Attributi.
Quindi, il pixel in alto a sinistra dell‚Äôoggetto si trova a 128 pixel dalla parte superiore dello schermo e a 16 da quella sinistra.
L‚ÄôID tessera e gli attributi sono entrambi impostati a 0.</p>
<p>Come si ricorder√† dalla lezione precedente, stiamo gi√† usando l‚ÄôID 0, che √® l‚Äôinizio della grafica del nostro sfondo.
Tuttavia, per impostazione predefinita, gli oggetti e gli sfondi utilizzano un insieme diverso di piastrelle, almeno per i primi 128 ID.
Le mattonelle con ID 128-255 sono condivise da entrambi, il che √® utile se si ha una mattonella che viene utilizzata sia dallo sfondo che da un oggetto.</p>
<p>Se si preme F5 in BGB per aprire il visualizzatore VRAM, si dovrebbero vedere tre sezioni distinte.</p>
<p><img src="https://user-images.githubusercontent.com/14899090/196176886-8ede7369-c172-45fa-9128-cc238c15b1e8.png" alt="image" /></p>
<p>Poich√© dobbiamo caricarla in un‚Äôarea diversa, useremo l‚Äôindirizzo $8000 e caricheremo una grafica per la paletta del gioco.
Lo faremo subito dopo <code>CopyTilemap</code>:</p>
<pre><code class="language-rgbasm linenos start=46">	; Copy the tile data
	ld de, Paddle
	ld hl, $8000
	ld bc, PaddleEnd - Paddle
CopyPaddle:
	ld a, [de]
	ld [hli], a
	inc de
	dec bc
	ld a, b
	or a, c
	jp nz, CopyPaddle
</code></pre>
<p>E non dimenticate di aggiungere <code>Paddle</code> alla fine del codice.</p>
<pre><code class="language-rgbasm">Paddle:
	dw `13333331
	dw `30000003
	dw `13333331
	dw `00000000
	dw `00000000
	dw `00000000
	dw `00000000
	dw `00000000
PaddleEnd:
</code></pre>
<p>Infine, abilitiamo gli oggetti e vediamo il risultato.
Gli oggetti devono essere abilitati dal noto registro <code>rLCDC</code>, altrimenti non vengono visualizzati.
(Questo √® il motivo per cui non abbiamo dovuto cancellare l‚ÄôOAM nelle lezioni precedenti).
Dobbiamo anche inizializzare una delle tavolozze degli oggetti, <code>rOBP0</code>.
In realt√† ci sono due tavolozze di oggetti, ma ne useremo solo una.</p>
<pre><code class="language-rgbasm linenos start=76">	; Turn the LCD on
	ld a, LCDCF_ON | LCDCF_BGON | LCDCF_OBJON
	ld [rLCDC], a

	; During the first (blank) frame, initialize display registers
	ld a, %11100100
	ld [rBGP], a
	ld a, %11100100
	ld [rOBP0], a
</code></pre>
<h2 id="movimento"><a class="header" href="#movimento">Movimento</a></h2>
<p>Ora che abbiamo un oggetto sullo schermo, spostiamolo.
In precedenza, il ciclo <code>Done</code> non faceva nulla; rinominiamolo in <code>Main</code> e usiamolo per spostare il nostro oggetto.
Aspetteremo VBlank prima di cambiare OAM, proprio come abbiamo fatto prima di spegnere lo schermo.</p>
<p>``rgbasm,linenos,start=89
Main:
; Attendere finch√© non √® <em>non</em> VBlank
ld a, [rLY]
cp 144
jp nc, Main
WaitVBlank2:
ld a, [rLY]
cp 144
jp c, WaitVBlank2</p>
<pre><code>; Sposta la paletta di un pixel a destra.
ld a, [_OAMRAM + 1]
inc a
ld [_OAMRAM + 1], a
jp Main
</code></pre>
<pre><code>
::: tip:ü§®

In questo caso, si accede all'OAM senza spegnere l'LCD, ma √® comunque sicuro.
Per spiegarne il motivo √® necessaria una spiegazione pi√π approfondita del rendering del Game Boy, quindi per ora ignoriamolo.

:::

Ora si dovrebbe vedere la paletta muoversi... molto velocemente.
Poich√© si muove di un pixel per fotogramma, la velocit√† √® di 60 pixel al secondo!
Per rallentare il movimento, useremo una *variabile*.

Finora abbiamo lavorato solo con i registri della CPU, ma √® possibile creare anche variabili globali!
Per farlo, creiamo un'altra sezione, ma mettiamola in `WRAM0` invece che in `ROM0`.
A differenza della ROM (&quot;Read-Only Memory&quot;, memoria di sola lettura), la RAM (&quot;Random-Access Memory&quot;, memoria ad accesso casuale) pu√≤ essere scritta; quindi, la WRAM, o Work RAM, √® il luogo in cui possiamo memorizzare le variabili del nostro gioco.

Aggiungete questo in fondo al vostro file:

```rgbasm,linenos,start=358
SECTION &quot;Counter&quot;, WRAM0
wFrameCounter: db
```

Ora useremo la variabile `wFrameCounter` per contare quanti fotogrammi sono passati dall'ultimo spostamento della paletta.
Ogni 10¬∞ fotogramma, sposteremo la racchetta di un pixel, rallentandola a 6 pixel al secondo.
Non dimenticate che all'avvio del Game Boy la RAM si riempie di valori spazzatura, quindi √® necessario inizializzare le variabili prima di utilizzarle.

```rgbasm,linenos,start=86
	ld a, 0
	ld [wFrameCounter], a

Main:
	ld a, [rLY]
	cp 144
	jp nc, Main
WaitVBlank2:
	ld a, [rLY]
	cp 144
	jp c, WaitVBlank2

	ld a, [wFrameCounter]
	inc a
	ld [wFrameCounter], a
	cp a, 15 ; Every 15 frames (a quarter of a second), run the following code
	jp nz, Main

	; Reset the frame counter back to 0
	ld a, 0
	ld [wFrameCounter], a

	; Move the paddle one pixel to the right.
	ld a, [_OAMRAM + 1]
	inc a
	ld [_OAMRAM + 1], a
	jp Main
```

Bene!
Il prossimo passo √® prendere il controllo della paletta.
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../part2/getting-started.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../part2/functions.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../part2/getting-started.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../part2/functions.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../js/linenos.js"></script>


    </body>
</html>
